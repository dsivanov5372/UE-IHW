# Индивидуальное домашнее задание
## Исполнитель: Иванов Дмитрий Сергеевич, БПИ214

##### (желаемая оценка: 6)

### О том, как генерируются комнаты

В целом, основа взята [отсюда](https://youtu.be/XgIDH42RHWQ?si=aKt-0Ds4snW0vA48), однако генерация была упрощена в некотором роде: алгоритм в целом построен так, что мы генерируем квадратные комнаты из дефолтных мешей, идущих в движке (квадратные плиты для пола, стены, двери). В нашем случае имеем комнату размером 5x5, однако эти параметры можно изменить в классе BP_Room, поменяв значения RoomTilesX и RoomTilesY.

Кроме того, мы фиксировано создаём две двери в другие комнаты, другие комнаты генерируются при открытии двери, заранее игрок локацию увидеть не сможет, однако может понять её сложность, поскольку над дверью в "сложную" комнату будет висеть соответствующая надпись.

В случае стартовой комнаты мы генерируем двери следующим образом: сначала мы берём перед и заднюю часть комнаты, и выбираем позицию для первой двери, затем мы берём правую и левую часть комнаты и выбираем ещё одну позицию. В противном случае мы просто выбираем одну позицию, в которой не будет двери, среди передней части, правой и левой, так как в задней части двери не может быть, поскольку она там есть по умолчанию (точка входа в комнату). Каждая дверь находится по центру стены.

Сложность комнаты выбирается при создании двери (создаются последовательно). Для первой двери она выбирается случайно, для второй алгоритм детерменированный. Если предыдущая дверь - сложная, то данная будет вести в простую комнату. И наоборот, если предыдущая дверь ведёт в простую комнату, то данная будет вести в сложную.

Когда игрок открывает дверь, за ней генерируется новая комната, при этом комната генерируется "выравненно", то есть она в некотором смысле является продолжением предыдущей, если убрать стену между ними. Когда игрок заходит в данную комнату, за ним образуется стена, которая не позволит вернуться игроку в предыдущую комнату. Кроме того, при открытии двери, оставшаяся дверь блокируется, игрок уже не сможет её открыть, и ему лишь остаётся идти в открытую дверь.

Когда игрок доходит до финальной комнаты, в ней не генируются двери. Но генерируется объект в виде двух бутылок вина и китайской лапши, при пересечении коллизии которой игрок завершает игру.

Количество комнат для прохождения выбирается случайно при старте игры, от 6 до 10 комнат.

### Про ловушки

Мы имеем два вида ловушек: статические (пики в виде белых конусов) и динамические (различные виды пил, бревно, которое ведёт себя как качель, шипы, которые вылезают из пола).

Статические ловушки генериуются по краям комнаты, возле стен, и наносят относительно небольшой урон. Это для того, чтобы у игрока не было желания обойти ловушки по краю комнаты, считерив тем самым.

Часть динамический ловушек генерируются по центру комнаты в случайных координатах (Пилы на стойках, пилы, катающиеся по полу). Другая часть генерируются прямо возле входов в другие комнаты (Бревно, шипы в полу и пила, двигающаяся по вертикали по стойкам), если игрок зашёл (в том числе ранее) в сложную комнату.

### Про сложность

В целом, заходя в сложную комнату, игрок иницирует спавн ловушек прямо возле дверей в текущей и последующих комнатах. Кроме того, заходя в сложную комнату, игрок увеличивает получаемый урон (множитель урона) в текущей и последующих комнатах на 0.2 (по умолчанию 1). Также в сложной комнате спавнится "аптечка", её позиция фиксированная и находится сразу возле входа в комнату. В простой комнате её не бывает.

### Баффы/дебаффы

В игре существует два вида баффов: защита (объект в виде виджета с иконкой щита, даёт бессмертие на 15 секунд), замедление ловушек (объект в виде виджета с иконкой песочных часов, замедляет ловушки в 2 раза на 15 секунд), а также один вид дебаффа: замедление игрока (объект в виде виджета с иконкой скорости, замедляет игрока в 2 раза на 15 секунд).

Также есть предмет, который накладывает случайный бафф или дебафф (объект в виде виджета с иконкой вопросительного знака).

Все эти предметы спавнятся в каждой комнате, в количестве трёх штук на комнату, однако выбор предметов случаен, но позиция их детерменированная (возле возможных входов в другие комнаты).

### Ещё немного про игру в целом

Каждая комната это актор, ссылку на которого хранится в массиве внутри игрока. При этом количество ссылок на комнаты внутри массива <= 2. Когда появляется третий элемент в массиве, автоматически происходит уничтожение актора в нулевой позиции массива, со всеми ловушками и эффектами внутри комнаты. Эффекты и ловушки комнаты хранятся в соответствующих массивах класса комнаты. Тем самым мы гарантируем "адекватную" генерацию комнат, поскольку они никогда не будут наслаиваться друг на друга, и мы в целом можем ходить кругами.